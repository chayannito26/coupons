<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Coupon Admin · Secure Manager</title>
  <meta name="robots" content="noindex, nofollow">
  <meta name="description" content="Manage, validate, and monitor discount coupons with Chayannito 26's secure dashboard.">
  <!-- Open Graph -->
  <meta property="og:title" content="Chayannito 26 Coupon Management Dashboard">
  <meta property="og:description" content="Manage, validate, and monitor discount coupons with Chayannito 26's secure dashboard.">
  <meta property="og:image" content="https://chayannito26.com/coupons/image.jpg">
  <meta property="og:url" content="https://chayannito26.com/coupons">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Chayannito 26 Coupon Management Dashboard">
  <meta property="og:brand" content="Chayannito 26">

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Chayannito 26 Coupon Management Dashboard">
  <meta name="twitter:description" content="Manage, validate, and monitor discount coupons with Chayannito 26's secure dashboard.">
  <meta name="twitter:image" content="https://chayannito26.com/coupons/image.jpg">
  <meta name="twitter:site" content="@chayannito26">
  <meta name="twitter:creator" content="@wasi_master">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">%</div>
      <div class="titles">
        <h1>Coupon Admin</h1>
        <span class="subtitle">Manage, validate, and monitor discounts</span>
      </div>
    </div>
    <div class="actions">
      <button id="connectBtn" class="btn ghost" title="Connect to Firebase">
        <span class="dot offline" id="connDot"></span>
        <span id="connText">Connect</span>
      </button>
      <div class="divider"></div>
      <button id="toggleViewBtn" class="btn">
        <span class="icon">📇</span>
        <span id="toggleViewText">Cards</span>
      </button>
      <div class="divider"></div>
      <div class="menu">
        <button class="btn">Export ▾</button>
        <div class="menu-content">
          <button id="exportJsonBtn" class="menu-item">Export JSON</button>
          <button id="exportCsvBtn" class="menu-item">Export CSV</button>
        </div>
      </div>
      <button id="importBtn" class="btn">Import</button>
      <button id="createBtn" class="btn primary">Create Coupon</button>
    </div>
  </header>

  <main class="container">
    <div id="alertArea"></div>

    <section class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <h2>Coupons</h2>
          <span id="couponCount" class="muted"></span>
        </div>
        <div class="panel-tools">
          <input id="searchInput" type="search" class="input" placeholder="Search code, scope, type…" />
          <select id="statusFilter" class="input">
            <option value="all">All statuses</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
            <option value="expired">Expired</option>
            <option value="expiring">Expiring soon</option>
          </select>
          <select id="typeFilter" class="input">
            <option value="all">All types</option>
            <option value="percentage">Percentage</option>
            <option value="fixed">Fixed</option>
          </select>
        </div>
      </div>

      <div id="tableWrap" class="table-wrap">
        <table class="table" id="couponTable" aria-label="Coupons table">
          <thead>
            <tr>
              <th>Code</th>
              <th>Type</th>
              <th>Value</th>
              <th>Scope</th>
              <th>Min Order</th>
              <th>Max Discount</th>
              <th>Active</th>
              <th>Expiry</th>
              <th>Usage</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="couponTbody">
            <!-- Rows render here -->
          </tbody>
        </table>
        <div id="emptyState" class="empty" hidden>
          <div class="empty-icon">🧾</div>
          <div class="empty-title">No coupons yet</div>
          <div class="empty-desc">Create your first coupon or import from a CSV/JSON file.</div>
          <div class="empty-actions">
            <button id="emptyCreateBtn" class="btn primary">Create Coupon</button>
            <button id="emptyImportBtn" class="btn">Import</button>
          </div>
        </div>
      </div>

      <div id="cardsWrap" class="cards-wrap" hidden>
        <div id="cardsGrid" class="cards-grid">
          <!-- Cards render here -->
        </div>
      </div>
    </section>
  </main>

  <div id="toastHost" class="toast-host" aria-live="polite"></div>

  <!-- Coupon Modal -->
  <dialog id="couponModal" class="modal">
    <form id="couponForm" method="dialog" class="modal-content" novalidate>
      <div class="modal-header">
        <h3 id="couponModalTitle">Create Coupon</h3>
        <button type="button" class="icon-btn" data-close-modal aria-label="Close">✖</button>
      </div>
      <div class="modal-body grid">
        <div class="field">
          <label for="code">Code</label>
          <input
            id="code"
            name="code"
            class="input"
            placeholder="e.g. SUMMER25"
            required
            minlength="3"
            maxlength="32"
            spellcheck="false"
            autocomplete="off"
            autocapitalize="characters"
            aria-describedby="codeDesc codeError"
            title="Required. Unique code customers enter at checkout (e.g., SUMMER25). 3–32 chars; letters, numbers, or dashes." />
          <div class="desc" id="codeDesc">Required. Unique checkout code. Use letters, numbers, or dashes; 3–32 characters.</div>
          <div class="error" id="codeError"></div>
        </div>

        <div class="field">
          <label for="type">Discount Type</label>
          <select
            id="type"
            name="type"
            class="input"
            aria-describedby="typeDesc"
            title="Required. Choose how the discount is applied: percentage (0–100) or fixed (in USD).">
            <option value="percentage">percentage</option>
            <option value="fixed">fixed</option>
          </select>
          <div class="desc" id="typeDesc">Choose how to apply the discount. Percentage (e.g., 15%) or fixed amount (e.g., $10).</div>
        </div>

        <div class="field">
          <label for="value">Discount Value</label>
          <input
            id="value"
            name="value"
            class="input"
            type="number"
            step="0.01"
            min="0"
            placeholder="e.g. 25 or 10.00"
            required
            aria-describedby="valueDesc valueError"
            title="Required. If percentage: 0–100. If fixed: at least 1 (USD)."/>
          <div class="desc" id="valueDesc">Required. If percentage, enter 0–100. If fixed, enter a value ≥ 1 (USD).</div>
          <div class="error" id="valueError"></div>
        </div>

        <div class="field">
          <label for="scope">Scope</label>
          <select
            id="scope"
            name="scope"
            class="input"
            aria-describedby="scopeDesc"
            title="Required.Where the coupon applies: entire catalog, a category, or a specific product.">
            <option value="all">all</option>
            <option value="category">category</option>
            <option value="product">product</option>
          </select>
          <div class="desc" id="scopeDesc">Choose where the coupon applies: All products, a Product category, or a single Product.</div>
        </div>

        <div class="field" id="scopeValueField" hidden>
          <label for="scopeValue">Scope Value</label>
          <input
            id="scopeValue"
            name="scopeValue"
            class="input"
            placeholder="e.g. shoes or SKU-123"
            aria-describedby="scopeValueDesc"
            title="Required when Scope is category or product. Provide the category name or product ID/SKU." />
          <div class="desc" id="scopeValueDesc">Required only when Scope is category or product. Enter the category name or Product ID/SKU.</div>
        </div>

        <div class="field">
          <label for="minOrderAmount">Minimum Order Amount</label>
          <input
            id="minOrderAmount"
            name="minOrderAmount"
            class="input"
            type="number"
            step="0.01"
            min="0"
            placeholder="e.g. 50.00"
            aria-describedby="minOrderAmountDesc minOrderAmountError"
            title="Optional. Minimum order subtotal required (before taxes/shipping). Leave blank for no minimum." />
          <div class="desc" id="minOrderAmountDesc">Optional. Minimum order subtotal (before taxes/shipping). Leave blank for no minimum.</div>
          <div class="error" id="minOrderAmountError"></div>
        </div>

        <div class="field">
          <label for="maxDiscount">Maximum Discount</label>
          <input
            id="maxDiscount"
            name="maxDiscount"
            class="input"
            type="number"
            step="0.01"
            min="0"
            placeholder="e.g. 100.00"
            aria-describedby="maxDiscountDesc maxDiscountError"
            title="Optional. Caps the discount applied per order. Useful with percentage discounts." />
          <div class="desc" id="maxDiscountDesc">Optional. Caps the discount per order. Useful to limit percentage discounts.</div>
          <div class="error" id="maxDiscountError"></div>
        </div>

        <div class="field toggle">
          <label for="isActive">Active</label>
          <label class="switch" title="Active coupons can be used unless expired or exceeded their limit.">
            <input
              id="isActive"
              name="isActive"
              type="checkbox"
              aria-describedby="isActiveDesc isActiveError" />
            <span class="slider"></span>
          </label>
          <div class="desc" id="isActiveDesc">When ON, coupon can be used (subject to expiry and usage limits). Turn OFF to pause.</div>
          <div class="error" id="isActiveError"></div>
        </div>

        <div class="field">
          <label for="expiryDate">Expiry Date</label>
          <input
            id="expiryDate"
            name="expiryDate"
            class="input"
            type="date"
            aria-describedby="expiryDateDesc"
            title="Optional. Coupon remains valid through this date (end of day). Leave blank for no expiry." />
          <div class="desc" id="expiryDateDesc">Optional. Valid through the selected date (end of day). Leave blank for no expiry.</div>
        </div>

        <div class="field">
          <label for="usageLimit">Usage Limit</label>
          <input
            id="usageLimit"
            name="usageLimit"
            class="input"
            type="number"
            step="1"
            min="0"
            placeholder="e.g. 100"
            aria-describedby="usageLimitDesc usageLimitError"
            title="Optional. Maximum total uses across all customers. Leave blank for unlimited." />
          <div class="desc" id="usageLimitDesc">Optional. Maximum total uses across all customers. Leave blank for unlimited.</div>
          <div class="error" id="usageLimitError"></div>
        </div>

        <div class="field readonly">
          <label for="usedCount">Used Count</label>
          <input
            id="usedCount"
            name="usedCount"
            class="input"
            type="number"
            readonly
            title="Read-only. Tracks the number of times customers used this coupon." />
          <div class="desc">Read-only. Tracks how many times customers used this coupon.</div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" data-close-modal class="btn">Cancel</button>
        <button id="saveCouponBtn" type="submit" class="btn primary">
          <span class="spinner" hidden></span>
          <span class="label">Save</span>
        </button>
      </div>
      <input type="hidden" id="docId" />
      <input type="hidden" id="mode" />
    </form>
  </dialog>

  <!-- Delete Confirm Modal -->
  <dialog id="confirmModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Delete Coupon</h3>
        <button type="button" class="icon-btn" data-close-modal aria-label="Close">✖</button>
      </div>
      <div class="modal-body">
        <p id="confirmText" class="confirm-text"></p>
      </div>
      <div class="modal-footer">
        <button type="button" data-close-modal class="btn">Cancel</button>
        <button id="confirmDeleteBtn" class="btn danger">Delete</button>
      </div>
    </div>
  </dialog>

  <!-- Import Modal -->
  <dialog id="importModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Import Coupons</h3>
        <button type="button" class="icon-btn" data-close-modal aria-label="Close">✖</button>
      </div>
      <div class="modal-body">
        <div class="import-area">
          <input id="importFile" type="file" accept=".json,.csv" />
          <div class="desc">
            Upload JSON or CSV with columns:
            code,type,value,scope,scopeValue,minOrderAmount,maxDiscount,isActive,expiryDate,usageLimit,usedCount.
            Dates: YYYY-MM-DD or ISO 8601. isActive: true/false. Empty fields are treated as “no limit” or not set.
            Duplicates are matched by code; choose Skip or Update for duplicates.
          </div>
        </div>
        <div class="import-options">
          <label><input type="radio" name="importMode" value="skip" checked /> Skip duplicates (by code)</label>
          <label><input type="radio" name="importMode" value="update" /> Update duplicates</label>
        </div>
        <div class="import-preview" id="importPreview"></div>
        <div class="error" id="importError"></div>
      </div>
      <div class="modal-footer">
        <button type="button" data-close-modal class="btn">Cancel</button>
        <button id="confirmImportBtn" class="btn primary" disabled>Import</button>
      </div>
    </div>
  </dialog>

  <script type="module" src="./app.js"></script>
</body>
</html>
