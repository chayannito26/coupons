<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Coupon Admin Â· Secure Manager</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">%</div>
      <div class="titles">
        <h1>Coupon Admin</h1>
        <span class="subtitle">Manage, validate, and monitor discounts</span>
      </div>
    </div>
    <div class="actions">
      <button id="connectBtn" class="btn ghost" title="Connect to Firebase">
        <span class="dot offline" id="connDot"></span>
        <span id="connText">Connect</span>
      </button>
      <div class="divider"></div>
      <button id="toggleViewBtn" class="btn">
        <span class="icon">ðŸ“‡</span>
        <span id="toggleViewText">Cards</span>
      </button>
      <div class="divider"></div>
      <div class="menu">
        <button class="btn">Export â–¾</button>
        <div class="menu-content">
          <button id="exportJsonBtn" class="menu-item">Export JSON</button>
          <button id="exportCsvBtn" class="menu-item">Export CSV</button>
        </div>
      </div>
      <button id="importBtn" class="btn">Import</button>
      <button id="createBtn" class="btn primary">Create Coupon</button>
    </div>
  </header>

  <main class="container">
    <div id="alertArea"></div>

    <section class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <h2>Coupons</h2>
          <span id="couponCount" class="muted"></span>
        </div>
        <div class="panel-tools">
          <input id="searchInput" type="search" class="input" placeholder="Search code, scope, typeâ€¦" />
          <select id="statusFilter" class="input">
            <option value="all">All statuses</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
            <option value="expired">Expired</option>
            <option value="expiring">Expiring soon</option>
          </select>
          <select id="typeFilter" class="input">
            <option value="all">All types</option>
            <option value="percentage">Percentage</option>
            <option value="fixed">Fixed</option>
          </select>
        </div>
      </div>

      <div id="tableWrap" class="table-wrap">
        <table class="table" id="couponTable" aria-label="Coupons table">
          <thead>
            <tr>
              <th>Code</th>
              <th>Type</th>
              <th>Value</th>
              <th>Scope</th>
              <th>Min Order</th>
              <th>Max Discount</th>
              <th>Active</th>
              <th>Expiry</th>
              <th>Usage</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="couponTbody">
            <!-- Rows render here -->
          </tbody>
        </table>
        <div id="emptyState" class="empty" hidden>
          <div class="empty-icon">ðŸ§¾</div>
          <div class="empty-title">No coupons yet</div>
          <div class="empty-desc">Create your first coupon or import from a CSV/JSON file.</div>
          <div class="empty-actions">
            <button id="emptyCreateBtn" class="btn primary">Create Coupon</button>
            <button id="emptyImportBtn" class="btn">Import</button>
          </div>
        </div>
      </div>

      <div id="cardsWrap" class="cards-wrap" hidden>
        <div id="cardsGrid" class="cards-grid">
          <!-- Cards render here -->
        </div>
      </div>
    </section>
  </main>

  <div id="toastHost" class="toast-host" aria-live="polite"></div>

  <!-- Coupon Modal -->
  <dialog id="couponModal" class="modal">
    <form id="couponForm" method="dialog" class="modal-content" novalidate>
      <div class="modal-header">
        <h3 id="couponModalTitle">Create Coupon</h3>
        <button type="button" class="icon-btn" data-close-modal aria-label="Close">âœ–</button>
      </div>
      <div class="modal-body grid">
        <div class="field">
          <label for="code">Code</label>
          <input id="code" name="code" class="input" placeholder="e.g. SUMMER25" required />
          <div class="desc">Unique code customers enter at checkout.</div>
          <div class="error" id="codeError"></div>
        </div>

        <div class="field">
          <label for="type">Discount Type</label>
          <select id="type" name="type" class="input">
            <option value="percentage">percentage</option>
            <option value="fixed">fixed</option>
          </select>
          <div class="desc">Choose percentage (like 15%) or fixed amount (like $10).</div>
        </div>

        <div class="field">
          <label for="value">Discount Value</label>
          <input id="value" name="value" class="input" type="number" step="0.01" placeholder="e.g. 25 or 10.00" required />
          <div class="desc">If percentage, 0â€“100. If fixed, 1 or more.</div>
          <div class="error" id="valueError"></div>
        </div>

        <div class="field">
          <label for="scope">Scope</label>
          <select id="scope" name="scope" class="input">
            <option value="all">all</option>
            <option value="category">category</option>
            <option value="product">product</option>
          </select>
          <div class="desc">Where the coupon applies.</div>
        </div>

        <div class="field" id="scopeValueField" hidden>
          <label for="scopeValue">Scope Value</label>
          <input id="scopeValue" name="scopeValue" class="input" placeholder="e.g. shoes or SKU-123" />
          <div class="desc">Category name or Product ID/SKU.</div>
        </div>

        <div class="field">
          <label for="minOrderAmount">Minimum Order Amount</label>
          <input id="minOrderAmount" name="minOrderAmount" class="input" type="number" step="0.01" placeholder="e.g. 50.00" />
          <div class="desc">Optional. Leave blank if no minimum.</div>
          <div class="error" id="minOrderAmountError"></div>
        </div>

        <div class="field">
          <label for="maxDiscount">Maximum Discount</label>
          <input id="maxDiscount" name="maxDiscount" class="input" type="number" step="0.01" placeholder="e.g. 100.00" />
          <div class="desc">Optional cap on discount amount.</div>
          <div class="error" id="maxDiscountError"></div>
        </div>

        <div class="field toggle">
          <label for="isActive">Active</label>
          <label class="switch">
            <input id="isActive" name="isActive" type="checkbox" />
            <span class="slider"></span>
          </label>
          <div class="desc">Inactive coupons cannot be used.</div>
          <div class="error" id="isActiveError"></div>
        </div>

        <div class="field">
          <label for="expiryDate">Expiry Date</label>
          <input id="expiryDate" name="expiryDate" class="input" type="date" />
          <div class="desc">Optional. Coupon is invalid after this date.</div>
        </div>

        <div class="field">
          <label for="usageLimit">Usage Limit</label>
          <input id="usageLimit" name="usageLimit" class="input" type="number" placeholder="e.g. 100" />
          <div class="desc">Optional. Total number of times this coupon can be used.</div>
          <div class="error" id="usageLimitError"></div>
        </div>

        <div class="field readonly">
          <label for="usedCount">Used Count</label>
          <input id="usedCount" name="usedCount" class="input" type="number" readonly />
          <div class="desc">Read-only. Tracks how many times customers used this coupon.</div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" data-close-modal class="btn">Cancel</button>
        <button id="saveCouponBtn" type="submit" class="btn primary">
          <span class="spinner" hidden></span>
          <span class="label">Save</span>
        </button>
      </div>
      <input type="hidden" id="docId" />
      <input type="hidden" id="mode" />
    </form>
  </dialog>

  <!-- Delete Confirm Modal -->
  <dialog id="confirmModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Delete Coupon</h3>
        <button type="button" class="icon-btn" data-close-modal aria-label="Close">âœ–</button>
      </div>
      <div class="modal-body">
        <p id="confirmText" class="confirm-text"></p>
      </div>
      <div class="modal-footer">
        <button type="button" data-close-modal class="btn">Cancel</button>
        <button id="confirmDeleteBtn" class="btn danger">Delete</button>
      </div>
    </div>
  </dialog>

  <!-- Import Modal -->
  <dialog id="importModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Import Coupons</h3>
        <button type="button" class="icon-btn" data-close-modal aria-label="Close">âœ–</button>
      </div>
      <div class="modal-body">
        <div class="import-area">
          <input id="importFile" type="file" accept=".json,.csv" />
          <div class="desc">Upload JSON or CSV with columns: code,type,value,scope,scopeValue,minOrderAmount,maxDiscount,isActive,expiryDate,usageLimit,usedCount</div>
        </div>
        <div class="import-options">
          <label><input type="radio" name="importMode" value="skip" checked /> Skip duplicates (by code)</label>
          <label><input type="radio" name="importMode" value="update" /> Update duplicates</label>
        </div>
        <div class="import-preview" id="importPreview"></div>
        <div class="error" id="importError"></div>
      </div>
      <div class="modal-footer">
        <button type="button" data-close-modal class="btn">Cancel</button>
        <button id="confirmImportBtn" class="btn primary" disabled>Import</button>
      </div>
    </div>
  </dialog>

  <script type="module" src="./app.js"></script>
</body>
</html>
